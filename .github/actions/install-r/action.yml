name: Install R and packages
description: Action for installing R and packages

inputs:
  R_VERSION:
    description: "Version of R to install"
    required: true

runs:
  using: "composite"
  steps:
    - name: Install R
      uses: r-lib/actions/setup-r@v2

    - name: Install R packages
      run: |
        R_HOME=$(Rscript -e 'cat(R.home(component = "home"), fill=TRUE)')
        R_PROFILE_SITE="$R_HOME"/etc/Rprofile.site
        echo " options(" >> $R_PROFILE_SITE
        echo "   repos=c(CRAN=\"https://packagemanager.posit.co/cran/__linux__/jammy/2024-09-07'),"
        echo "   HTTPUserAgent = sprintf('R/%s R (%s)', getRversion(), paste(getRversion(), R.version['platform'], R.version['arch'], R.version['os']))," >> $R_PROFILE_SITE
        echo "   download.file.extra = sprintf('--header \"User-Agent: R (%s)\"', paste(getRversion(), R.version['platform'], R.version['arch'], R.version['os']))" >> $R_PROFILE_SITE
        echo ")" >> $R_PROFILE_SITE
        Rscript -e 'install.packages("renv")'
      shell: bash
